#!/usr/bin/env python3
"""
청킹 기준 분석 - 현재 설정된 청킹 기준을 정확히 분석
"""

print("📏 현재 청킹 기준 분석")
print("=" * 60)

print("""
🎯 청킹 결정 기준:

1️⃣ **토큰 수 추정 기준:**
   - 계산식: content_length * 1.5 (한국어 기준 보수적 추정)
   - 임계값: 2000 토큰
   - 2000 토큰 이하 → 단일 임베딩
   - 2000 토큰 초과 → 청킹 처리

2️⃣ **문자 수 기준 환산:**
   - 2000 토큰 = 2000 ÷ 1.5 = 1333 문자
   - 즉, 약 1333자 이상이면 청킹됨

3️⃣ **청크 분할 설정:**
   - 청크 크기: 1500자 (약 2250 토큰)
   - 중복(overlap): 200자
   - 청크 간 중복으로 문맥 연결성 보장

4️⃣ **청킹 알고리즘:**
   - 우선순위 1: 문장 경계 (. ! ? 뒤 공백/개행)
   - 우선순위 2: 문단 경계 (개행 문자)
   - 우선순위 3: 단어 경계 (공백)
   - 최후 수단: 문자 경계로 강제 절단
""")

print("🔍 **실제 예시 분석:**")
print("   - Episode 14: 3개 청크 → 약 4000-5000자 추정")
print("   - Episode 24: 5개 청크 → 약 7000-8000자 추정")
print("   - Episode 464, 299: 단일 → 1333자 미만 추정")

print("\n📊 **청킹 임계값 정리:**")
print("   • 1333자 미만: 전체 에피소드로 임베딩")
print("   • 1333자 이상: 1500자 청크(200자 중복)로 분할")

print("\n🎯 **청킹 품질 보장:**")
print("   • 문장/문단 경계 우선 절단으로 의미 보존")
print("   • 200자 중복으로 문맥 연결성 유지")
print("   • 스마트 경계 탐지로 자연스러운 분할")

# 실제 청킹 함수의 세부 로직 확인
print("\n🔧 **청킹 알고리즘 세부사항:**")
print("   • 문장 끝 탐지: 전체 청크의 60% 이상 위치에서 탐색")
print("   • 문단 끝 탐지: 전체 청크의 60% 이상 위치에서 탐색")  
print("   • 단어 끝 탐지: 전체 청크의 70% 이상 위치에서 탐색")
print("   • 중복 제거: 동일 내용 청크 자동 제거")
print("   • 빈 청크 필터링: 공백만 있는 청크 제거")

print("\n" + "=" * 60)
print("현재 설정은 한국어 소설 콘텐츠에 최적화되어 있습니다.")